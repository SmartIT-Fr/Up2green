<?xml version="1.0" encoding="UTF-8"?>
<database name="default" namespace="Up2green\CommonBundle\Model" defaultIdMethod="native">

    <table name="voucher_category">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
        <column name="price" type="FLOAT" required="true" />
        <column name="credit" type="INTEGER" required="true" />
        <column name="is_purchasable" type="BOOLEAN" defaultValue="true" />
        <column name="is_partner_only" type="BOOLEAN" defaultValue="false" />
    </table>

    <table name="voucher" abstract="true">

        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
        <column name="category_id" type="INTEGER" />
        <column name="code" type="VARCHAR" size="128" required="true" />
        <column name="used_by" type="INTEGER" />
        <column name="owner_id" type="INTEGER" />
        <column name="log_ip" type="VARCHAR" size="15" />
        <column name="log_email" type="VARCHAR" size="255" />
        <column name="log_is_newsletter" type="BOOLEAN" required="true" defaultValue="true" />

        <behavior name="activatable" />
        <behavior name="timestampable" />

        <foreign-key foreignTable="voucher_category">
            <reference local="category_id" foreign="id" />
        </foreign-key>

        <foreign-key foreignTable="fos_user" phpName="user">
            <reference local="used_by" foreign="id" />
        </foreign-key>

        <foreign-key foreignTable="fos_user" phpName="owner">
            <reference local="owner_id" foreign="id" />
        </foreign-key>

        <unique>
            <unique-column name="code" />
            <unique-column name="class_key" />
        </unique>

        <column name="class_key" type="INTEGER" inheritance="single">
            <inheritance key="1" class="Voucher"/>
            <inheritance key="2" class="ReforestationVoucher" extends="Voucher"/>
            <inheritance key="3" class="EducationVoucher" extends="Voucher"/>
        </column>

    </table>

    <table name="mailingList">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
        <column name="email_address" type="VARCHAR" size="255" required="true" />
        <column name="is_newsletter" type="BOOLEAN" required="true" defaultValue="true" />

        <unique>
            <unique-column name="email_address" />
        </unique>
    </table>

    <table name="address">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
        <column name="name" type="VARCHAR" size="255" required="true" />
        <column name="street_line_1" type="VARCHAR" size="50" required="true" />
        <column name="street_line_2" type="VARCHAR" size="50" />
        <column name="zipcode" type="INTEGER" size="255" required="true" />
        <column name="city" type="VARCHAR" size="255" required="true" />
        <column name="country" type="VARCHAR" size="255" required="true" />
    </table>

    <table name="order">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
        <column name="payment_instruction_id" type="INTEGER" required="true" />
        <column name="amount" type="DECIMAL" scale="2" required="true" />

        <foreign-key foreignTable="payment_instruction">
            <reference local="payment_instruction_id" foreign="id"/>
        </foreign-key>
    </table>

</database>